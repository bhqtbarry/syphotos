<?php
function available_locales(): array
{
    return [
        'zh' => '简体中文',
        'en' => 'English',
        'fr' => 'Français',
        'de' => 'Deutsch',
        'it' => 'Italiano',
        'id' => 'Bahasa Indonesia',
        'es' => 'Español',
        'pt' => 'Português',
        'th' => 'ไทย',
        'ko' => '한국어',
        'ja' => '日本語',
        'ru' => 'Русский',
        'vi' => 'Tiếng Việt',
        'hi' => 'हिन्दी'
    ];
}

function is_supported_locale(string $code): bool
{
    return array_key_exists($code, available_locales());
}

function current_locale(): string
{
    if (!empty($_SESSION['locale']) && is_supported_locale($_SESSION['locale'])) {
        return $_SESSION['locale'];
    }
    if (!empty($_COOKIE['syphotos_locale']) && is_supported_locale($_COOKIE['syphotos_locale'])) {
        $_SESSION['locale'] = $_COOKIE['syphotos_locale'];
        return $_SESSION['locale'];
    }
    $locale = detect_locale();
    $_SESSION['locale'] = $locale;
    return $locale;
}

function detect_locale(): string
{
    $supported = array_keys(available_locales());
    $header = $_SERVER['HTTP_ACCEPT_LANGUAGE'] ?? '';
    $parts = explode(',', $header);
    foreach ($parts as $part) {
        $code = strtolower(trim(explode(';', $part)[0]));
        $code = substr($code, 0, 2);
        if (in_array($code, $supported, true)) {
            return $code;
        }
    }
    return 'en';
}

function translations(): array
{
    return [
        'en' => [
            'site_title' => 'SyPhotos Aviation Library',
            'nav_home' => 'Home',
            'nav_upload' => 'Upload',
            'nav_login' => 'Login',
            'nav_register' => 'Register',
            'nav_profile' => 'Profile',
            'nav_review' => 'Review',
            'search_placeholder' => 'Search registration, type, airline, airport',
            'latest_photos' => 'Latest Photos',
            'likes' => 'Likes',
            'exif' => 'EXIF Details',
            'submit' => 'Submit',
            'logout' => 'Logout',
            'footer_desc' => 'A global community for sharing aviation photography, capturing every inspiring flight moment.',
            'footer_quick_links' => 'Quick Links',
            'footer_home' => 'Home',
            'footer_all_photos' => 'All Photos',
            'footer_ladder' => 'Leaderboard',
            'footer_about_link' => 'About Us',
            'footer_contact_link' => 'Contact Us',
            'footer_help_center' => 'Help Center',
            'footer_rule' => 'Submission Rules',
            'footer_faq' => 'FAQ',
            'footer_terms' => 'User Agreement',
            'footer_privacy' => 'Privacy Policy',
            'footer_copyright' => 'Copyright Guide',
            'footer_language_title' => 'Language',
            'footer_language_hint' => 'Change the selection above to update the site instantly.',
            'footer_copyright_notice' => 'All rights reserved.',

        ],
        'zh' => [
            'site_title' => 'SyPhotos 航空图库',
            'nav_home' => '首页',
            'nav_upload' => '上传',
            'nav_login' => '登录',
            'nav_register' => '注册',
            'nav_profile' => '个人主页',
            'nav_review' => '审核',
            'search_placeholder' => '搜索注册号、机型、航司、机场',
            'latest_photos' => '最新照片',
            'likes' => '点赞',
            'exif' => 'EXIF 信息',
            'submit' => '提交',
            'logout' => '退出',
            'footer_desc' => '专注于航空摄影作品的分享与交流平台，连接全球航空摄影爱好者，记录每一个精彩的飞行瞬间，探索天空中的无限可能。',
            'footer_quick_links' => '快速链接',
            'footer_home' => '首页',
            'footer_all_photos' => '全部作品',
            'footer_ladder' => '排行榜',
            'footer_about_link' => '关于我们',
            'footer_contact_link' => '联系我们',
            'footer_help_center' => '帮助中心',
            'footer_rule' => '通过规则',
            'footer_faq' => '常见问题',
            'footer_terms' => '用户协议',
            'footer_privacy' => '隐私政策',
            'footer_copyright' => '版权说明',
            'footer_language_title' => '语言设置',
            'footer_language_hint' => '切换语言后页面内容将即时更新。',
            'footer_copyright_notice' => '保留所有权利',

        ],
        'fr' => [
            'site_title' => 'Bibliothèque aéronautique SyPhotos',
            'nav_home' => 'Accueil',
            'nav_upload' => 'Téléverser',
            'nav_login' => 'Connexion',
            'nav_register' => 'Inscription',
            'nav_profile' => 'Profil',
            'nav_review' => 'Modération',
            'search_placeholder' => 'Rechercher immatriculation, type, compagnie, aéroport',
            'latest_photos' => 'Dernières photos',
            'likes' => 'Mentions J’aime',
            'exif' => 'Détails EXIF',
            'submit' => 'Envoyer',
            'logout' => 'Déconnexion',
            'footer_desc' => 'Communauté mondiale dédiée au partage de photos aéronautiques, capturant chaque moment de vol inspirant.',
            'footer_quick_links' => 'Liens rapides',
            'footer_home' => 'Accueil',
            'footer_all_photos' => 'Toutes les photos',
            'footer_ladder' => 'Classement',
            'footer_about_link' => 'À propos',
            'footer_contact_link' => 'Contact',
            'footer_help_center' => 'Centre d''aide',
            'footer_rule' => 'Règles de soumission',
            'footer_faq' => 'FAQ',
            'footer_terms' => 'Conditions d''utilisation',
            'footer_privacy' => 'Politique de confidentialité',
            'footer_copyright' => 'Mention légale',
            'footer_language_title' => 'Langue',
            'footer_language_hint' => 'Changer la sélection met immédiatement le site à jour.',
            'footer_copyright_notice' => 'Tous droits réservés.',

        ],
        'es' => [
            'site_title' => 'Biblioteca de aviación SyPhotos',
            'nav_home' => 'Inicio',
            'nav_upload' => 'Subir',
            'nav_login' => 'Iniciar sesión',
            'nav_register' => 'Registrarse',
            'nav_profile' => 'Perfil',
            'nav_review' => 'Revisión',
            'search_placeholder' => 'Buscar matrícula, tipo, aerolínea, aeropuerto',
            'latest_photos' => 'Últimas fotos',
            'likes' => 'Me gusta',
            'exif' => 'Detalles EXIF',
            'submit' => 'Enviar',
            'logout' => 'Cerrar sesión',
            'footer_desc' => 'Plataforma global para compartir fotografía aeronáutica y capturar cada momento inspirador de vuelo.',
            'footer_quick_links' => 'Enlaces rápidos',
            'footer_home' => 'Inicio',
            'footer_all_photos' => 'Todas las fotos',
            'footer_ladder' => 'Clasificación',
            'footer_about_link' => 'Sobre nosotros',
            'footer_contact_link' => 'Contáctanos',
            'footer_help_center' => 'Centro de ayuda',
            'footer_rule' => 'Reglas de envío',
            'footer_faq' => 'Preguntas frecuentes',
            'footer_terms' => 'Acuerdo de usuario',
            'footer_privacy' => 'Política de privacidad',
            'footer_copyright' => 'Aviso de derechos de autor',
            'footer_language_title' => 'Idioma',
            'footer_language_hint' => 'Cambiar la opción actualiza el sitio al instante.',
            'footer_copyright_notice' => 'Todos los derechos reservados.',

        ],
        'pt' => [
            'site_title' => 'Biblioteca de aviação SyPhotos',
            'nav_home' => 'Início',
            'nav_upload' => 'Enviar',
            'nav_login' => 'Entrar',
            'nav_register' => 'Registrar',
            'nav_profile' => 'Perfil',
            'nav_review' => 'Revisão',
            'search_placeholder' => 'Buscar registro, tipo, companhia aérea, aeroporto',
            'latest_photos' => 'Fotos recentes',
            'likes' => 'Curtidas',
            'exif' => 'Detalhes EXIF',
            'submit' => 'Enviar',
            'logout' => 'Sair',
            'footer_desc' => 'Plataforma global para compartilhar fotografia aeronáutica e registrar cada momento inspirador de voo.',
            'footer_quick_links' => 'Links rápidos',
            'footer_home' => 'Início',
            'footer_all_photos' => 'Todas as fotos',
            'footer_ladder' => 'Classificação',
            'footer_about_link' => 'Sobre nós',
            'footer_contact_link' => 'Fale conosco',
            'footer_help_center' => 'Central de ajuda',
            'footer_rule' => 'Regras de envio',
            'footer_faq' => 'Perguntas frequentes',
            'footer_terms' => 'Acordo do usuário',
            'footer_privacy' => 'Política de privacidade',
            'footer_copyright' => 'Aviso de direitos autorais',
            'footer_language_title' => 'Idioma',
            'footer_language_hint' => 'Alterar a seleção acima atualiza o site na hora.',
            'footer_copyright_notice' => 'Todos os direitos reservados.',

        ],
        'de' => [
            'site_title' => 'SyPhotos Luftfahrtbibliothek',
            'nav_home' => 'Startseite',
            'nav_upload' => 'Hochladen',
            'nav_login' => 'Anmelden',
            'nav_register' => 'Registrieren',
            'nav_profile' => 'Profil',
            'nav_review' => 'Prüfung',
            'search_placeholder' => 'Suche nach Registrierung, Typ, Airline, Flughafen',
            'latest_photos' => 'Neueste Fotos',
            'likes' => 'Likes',
            'exif' => 'EXIF-Details',
            'submit' => 'Senden',
            'logout' => 'Abmelden',
            'footer_desc' => 'Globale Plattform zum Teilen von Luftfahrtfotografie, die jeden besonderen Flugmoment festhält.',
            'footer_quick_links' => 'Schnellzugriff',
            'footer_home' => 'Startseite',
            'footer_all_photos' => 'Alle Fotos',
            'footer_ladder' => 'Rangliste',
            'footer_about_link' => 'Über uns',
            'footer_contact_link' => 'Kontakt',
            'footer_help_center' => 'Hilfezentrum',
            'footer_rule' => 'Einreichungsregeln',
            'footer_faq' => 'FAQ',
            'footer_terms' => 'Nutzungsbedingungen',
            'footer_privacy' => 'Datenschutz',
            'footer_copyright' => 'Urheberrechtshinweis',
            'footer_language_title' => 'Sprache',
            'footer_language_hint' => 'Eine Auswahl oben aktualisiert die Seite sofort.',
            'footer_copyright_notice' => 'Alle Rechte vorbehalten.',

        ],
        'it' => [
            'site_title' => 'Biblioteca aeronautica SyPhotos',
            'nav_home' => 'Home',
            'nav_upload' => 'Carica',
            'nav_login' => 'Accedi',
            'nav_register' => 'Registrati',
            'nav_profile' => 'Profilo',
            'nav_review' => 'Revisione',
            'search_placeholder' => 'Cerca matricola, tipo, compagnia, aeroporto',
            'latest_photos' => 'Foto recenti',
            'likes' => 'Mi piace',
            'exif' => 'Dettagli EXIF',
            'submit' => 'Invia',
            'logout' => 'Esci',
            'footer_desc' => 'Piattaforma globale per condividere la fotografia aeronautica, catturando ogni momento di volo emozionante.',
            'footer_quick_links' => 'Link rapidi',
            'footer_home' => 'Home',
            'footer_all_photos' => 'Tutte le foto',
            'footer_ladder' => 'Classifica',
            'footer_about_link' => 'Chi siamo',
            'footer_contact_link' => 'Contattaci',
            'footer_help_center' => 'Centro assistenza',
            'footer_rule' => 'Regole di invio',
            'footer_faq' => 'Domande frequenti',
            'footer_terms' => 'Accordo con l''utente',
            'footer_privacy' => 'Informativa sulla privacy',
            'footer_copyright' => 'Guida al copyright',
            'footer_language_title' => 'Lingua',
            'footer_language_hint' => 'Cambia la selezione sopra per aggiornare subito il sito.',
            'footer_copyright_notice' => 'Tutti i diritti riservati.',

        ],
        'ru' => [
            'site_title' => 'Авиационная библиотека SyPhotos',
            'nav_home' => 'Главная',
            'nav_upload' => 'Загрузить',
            'nav_login' => 'Войти',
            'nav_register' => 'Регистрация',
            'nav_profile' => 'Профиль',
            'nav_review' => 'Проверка',
            'search_placeholder' => 'Поиск по регистрации, типу, авиакомпании, аэропорту',
            'latest_photos' => 'Новые фото',
            'likes' => 'Лайки',
            'exif' => 'Данные EXIF',
            'submit' => 'Отправить',
            'logout' => 'Выйти',
            'footer_desc' => 'Мировое сообщество любителей авиасъёмки, сохраняющее каждый вдохновляющий момент полёта.',
            'footer_quick_links' => 'Быстрые ссылки',
            'footer_home' => 'Главная',
            'footer_all_photos' => 'Все фото',
            'footer_ladder' => 'Рейтинг',
            'footer_about_link' => 'О нас',
            'footer_contact_link' => 'Связаться с нами',
            'footer_help_center' => 'Центр помощи',
            'footer_rule' => 'Правила публикации',
            'footer_faq' => 'ЧаВо',
            'footer_terms' => 'Пользовательское соглашение',
            'footer_privacy' => 'Политика конфиденциальности',
            'footer_copyright' => 'Авторские права',
            'footer_language_title' => 'Язык',
            'footer_language_hint' => 'Выберите язык выше, и сайт обновится мгновенно.',
            'footer_copyright_notice' => 'Все права защищены.',

        ],
        'ko' => [
            'site_title' => 'SyPhotos 항공 사진관',
            'nav_home' => '홈',
            'nav_upload' => '업로드',
            'nav_login' => '로그인',
            'nav_register' => '회원가입',
            'nav_profile' => '프로필',
            'nav_review' => '검토',
            'search_placeholder' => '등록부호, 기종, 항공사, 공항 검색',
            'latest_photos' => '최신 사진',
            'likes' => '좋아요',
            'exif' => 'EXIF 정보',
            'submit' => '제출',
            'logout' => '로그아웃',
            'footer_desc' => '항공 사진을 공유하는 글로벌 커뮤니티로, 모든 비행의 감동 순간을 기록합니다.',
            'footer_quick_links' => '바로가기',
            'footer_home' => '홈',
            'footer_all_photos' => '전체 사진',
            'footer_ladder' => '순위표',
            'footer_about_link' => '회사 소개',
            'footer_contact_link' => '문의하기',
            'footer_help_center' => '도움말 센터',
            'footer_rule' => '업로드 규정',
            'footer_faq' => '자주 묻는 질문',
            'footer_terms' => '이용 약관',
            'footer_privacy' => '개인정보 처리방침',
            'footer_copyright' => '저작권 안내',
            'footer_language_title' => '언어',
            'footer_language_hint' => '위 선택을 변경하면 사이트가 즉시 업데이트됩니다.',
            'footer_copyright_notice' => '판권 소유.',

        ],
        'ja' => [
            'site_title' => 'SyPhotos 航空ライブラリ',
            'nav_home' => 'ホーム',
            'nav_upload' => 'アップロード',
            'nav_login' => 'ログイン',
            'nav_register' => '登録',
            'nav_profile' => 'プロフィール',
            'nav_review' => '審査',
            'search_placeholder' => '登録記号、機種、航空会社、空港を検索',
            'latest_photos' => '最新写真',
            'likes' => 'いいね',
            'exif' => 'EXIF 詳細',
            'submit' => '送信',
            'logout' => 'ログアウト',
            'footer_desc' => '世界の航空写真ファンをつなぎ、感動的なフライトの瞬間を記録する共有プラットフォームです。',
            'footer_quick_links' => 'クイックリンク',
            'footer_home' => 'ホーム',
            'footer_all_photos' => 'すべての写真',
            'footer_ladder' => 'ランキング',
            'footer_about_link' => '私たちについて',
            'footer_contact_link' => 'お問い合わせ',
            'footer_help_center' => 'ヘルプセンター',
            'footer_rule' => '投稿ルール',
            'footer_faq' => 'よくある質問',
            'footer_terms' => '利用規約',
            'footer_privacy' => 'プライバシーポリシー',
            'footer_copyright' => '著作権ガイド',
            'footer_language_title' => '言語',
            'footer_language_hint' => '上部の選択を変更すると、サイトがすぐに更新されます。',
            'footer_copyright_notice' => '全ての権利を保有します。',

        ],
        'th' => [
            'site_title' => 'คลังภาพการบิน SyPhotos',
            'nav_home' => 'หน้าแรก',
            'nav_upload' => 'อัปโหลด',
            'nav_login' => 'เข้าสู่ระบบ',
            'nav_register' => 'สมัครสมาชิก',
            'nav_profile' => 'โปรไฟล์',
            'nav_review' => 'ตรวจสอบ',
            'search_placeholder' => 'ค้นหาทะเบียน, รุ่น, สายการบิน, สนามบิน',
            'latest_photos' => 'ภาพล่าสุด',
            'likes' => 'ถูกใจ',
            'exif' => 'รายละเอียด EXIF',
            'submit' => 'ส่ง',
            'logout' => 'ออกจากระบบ',
            'footer_desc' => 'แพลตฟอร์มชุมชนระดับโลกสำหรับแบ่งปันภาพถ่ายการบิน ถ่ายทอดทุกช่วงเวลาแห่งการบินอันน่าประทับใจ',
            'footer_quick_links' => 'ลิงก์ด่วน',
            'footer_home' => 'หน้าแรก',
            'footer_all_photos' => 'ภาพทั้งหมด',
            'footer_ladder' => 'กระดานจัดอันดับ',
            'footer_about_link' => 'เกี่ยวกับเรา',
            'footer_contact_link' => 'ติดต่อเรา',
            'footer_help_center' => 'ศูนย์ช่วยเหลือ',
            'footer_rule' => 'กติกาการส่งผลงาน',
            'footer_faq' => 'คำถามที่พบบ่อย',
            'footer_terms' => 'ข้อตกลงการใช้งาน',
            'footer_privacy' => 'นโยบายความเป็นส่วนตัว',
            'footer_copyright' => 'คำแนะนำลิขสิทธิ์',
            'footer_language_title' => 'ภาษา',
            'footer_language_hint' => 'เปลี่ยนตัวเลือกด้านบนเพื่ออัปเดตทั้งไซต์ทันที',
            'footer_copyright_notice' => 'สงวนลิขสิทธิ์ทั้งหมด',

        ],
        'id' => [
            'site_title' => 'Perpustakaan penerbangan SyPhotos',
            'nav_home' => 'Beranda',
            'nav_upload' => 'Unggah',
            'nav_login' => 'Masuk',
            'nav_register' => 'Daftar',
            'nav_profile' => 'Profil',
            'nav_review' => 'Tinjau',
            'search_placeholder' => 'Cari registrasi, tipe, maskapai, bandara',
            'latest_photos' => 'Foto terbaru',
            'likes' => 'Suka',
            'exif' => 'Detail EXIF',
            'submit' => 'Kirim',
            'logout' => 'Keluar',
            'footer_desc' => 'Komunitas global berbagi fotografi penerbangan, menangkap setiap momen penerbangan yang menginspirasi.',
            'footer_quick_links' => 'Tautan cepat',
            'footer_home' => 'Beranda',
            'footer_all_photos' => 'Semua foto',
            'footer_ladder' => 'Papan peringkat',
            'footer_about_link' => 'Tentang kami',
            'footer_contact_link' => 'Hubungi kami',
            'footer_help_center' => 'Pusat bantuan',
            'footer_rule' => 'Aturan pengiriman',
            'footer_faq' => 'FAQ',
            'footer_terms' => 'Perjanjian pengguna',
            'footer_privacy' => 'Kebijakan privasi',
            'footer_copyright' => 'Panduan hak cipta',
            'footer_language_title' => 'Bahasa',
            'footer_language_hint' => 'Ubah pilihan di atas untuk memperbarui situs seketika.',
            'footer_copyright_notice' => 'Hak cipta dilindungi.',

        ],
        'vi' => [
            'site_title' => 'Thư viện hàng không SyPhotos',
            'nav_home' => 'Trang chủ',
            'nav_upload' => 'Tải lên',
            'nav_login' => 'Đăng nhập',
            'nav_register' => 'Đăng ký',
            'nav_profile' => 'Hồ sơ',
            'nav_review' => 'Duyệt',
            'search_placeholder' => 'Tìm đăng ký, loại, hãng bay, sân bay',
            'latest_photos' => 'Ảnh mới nhất',
            'likes' => 'Thích',
            'exif' => 'Chi tiết EXIF',
            'submit' => 'Gửi',
            'logout' => 'Đăng xuất',
            'footer_desc' => 'Cộng đồng toàn cầu chia sẻ ảnh hàng không, lưu giữ mọi khoảnh khắc bay đầy cảm hứng.',
            'footer_quick_links' => 'Liên kết nhanh',
            'footer_home' => 'Trang chủ',
            'footer_all_photos' => 'Tất cả ảnh',
            'footer_ladder' => 'Bảng xếp hạng',
            'footer_about_link' => 'Về chúng tôi',
            'footer_contact_link' => 'Liên hệ',
            'footer_help_center' => 'Trung tâm trợ giúp',
            'footer_rule' => 'Quy tắc đăng tải',
            'footer_faq' => 'Câu hỏi thường gặp',
            'footer_terms' => 'Thỏa thuận người dùng',
            'footer_privacy' => 'Chính sách quyền riêng tư',
            'footer_copyright' => 'Hướng dẫn bản quyền',
            'footer_language_title' => 'Ngôn ngữ',
            'footer_language_hint' => 'Đổi lựa chọn bên trên để cập nhật trang ngay lập tức.',
            'footer_copyright_notice' => 'Bảo lưu mọi quyền.',

        ],
        'hi' => [
            'site_title' => 'SyPhotos विमानन लाइब्रेरी',
            'nav_home' => 'मुखपृष्ठ',
            'nav_upload' => 'अपलोड',
            'nav_login' => 'लॉगिन',
            'nav_register' => 'रजिस्टर',
            'nav_profile' => 'प्रोफ़ाइल',
            'nav_review' => 'समीक्षा',
            'search_placeholder' => 'रजिस्ट्रेशन, प्रकार, एयरलाइन, हवाई अड्डा खोजें',
            'latest_photos' => 'नवीनतम फोटो',
            'likes' => 'लाइक्स',
            'exif' => 'EXIF विवरण',
            'submit' => 'जमा करें',
            'logout' => 'लॉगआउट',
            'footer_desc' => 'एविएशन फ़ोटोग्राफ़ी साझा करने वाला वैश्विक मंच, हर प्रेरक उड़ान क्षण को सहेजता है।',
            'footer_quick_links' => 'त्वरित लिंक',
            'footer_home' => 'मुखपृष्ठ',
            'footer_all_photos' => 'सभी फ़ोटो',
            'footer_ladder' => 'लीडरबोर्ड',
            'footer_about_link' => 'हमारे बारे में',
            'footer_contact_link' => 'संपर्क करें',
            'footer_help_center' => 'सहायता केंद्र',
            'footer_rule' => 'सबमिशन नियम',
            'footer_faq' => 'अक्सर पूछे जाने वाले प्रश्न',
            'footer_terms' => 'उपयोगकर्ता समझौता',
            'footer_privacy' => 'गोपनीयता नीति',
            'footer_copyright' => 'कॉपीराइट मार्गदर्शन',
            'footer_language_title' => 'भाषा',
            'footer_language_hint' => 'ऊपर की भाषा चुनते ही पूरा साइट तुरंत बदल जाता है।',
            'footer_copyright_notice' => 'सर्वाधिकार सुरक्षित।',

        ],
    ];
}



function t(string $key): string
{
    $locale = current_locale();
    $bundle = translations();
    if (!isset($bundle[$locale])) {
        $locale = 'en';
    }
    return $bundle[$locale][$key] ?? $bundle['en'][$key] ?? $key;
}
